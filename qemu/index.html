<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>QEMU cheetsheet - p1-kernel</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">p1-kernel</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../lesson00/rpi-os/" class="nav-link">exp0</a>
                            </li>
                            <li class="navitem">
                                <a href="../lesson01/rpi-os/" class="nav-link">exp1</a>
                            </li>
                            <li class="navitem">
                                <a href="../lesson02/rpi-os/" class="nav-link">exp2</a>
                            </li>
                            <li class="navitem">
                                <a href="../lesson03/rpi-os/" class="nav-link">exp3</a>
                            </li>
                            <li class="navitem">
                                <a href="../lesson04a/rpi-os/" class="nav-link">exp4a</a>
                            </li>
                            <li class="navitem">
                                <a href="../lesson04b/rpi-os/" class="nav-link">exp4b</a>
                            </li>
                            <li class="navitem">
                                <a href="../lesson05/rpi-os/" class="nav-link">exp5</a>
                            </li>
                            <li class="navitem">
                                <a href="../lesson06/rpi-os/" class="nav-link">exp6</a>
                            </li>
                            <li class="navitem">
                                <a href="../gdb/" class="nav-link">gdb</a>
                            </li>
                            <li class="navitem">
                                <a href="../cheatsheet/" class="nav-link">cheatsheet</a>
                            </li>
                            <li class="navitem">
                                <a href="../ssh-proxy/" class="nav-link">ssh</a>
                            </li>
                            <li class="navitem">
                                <a href="../dump/" class="nav-link">dump</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#qemu-cheetsheet" class="nav-link">QEMU cheetsheet</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#add-qemu-to-path" class="nav-link">Add QEMU to PATH</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#launch-the-kernel" class="nav-link">Launch the kernel</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#launch-the-kernel-in-debug-mode" class="nav-link">Launch the kernel in debug mode</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#launch-the-kernel-with-monitor" class="nav-link">Launch the kernel with monitor</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#run-the-kernel-with-tracing" class="nav-link">Run the kernel with tracing</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#putting-everything-in-one-file-env-qemush" class="nav-link">Putting everything in one file (env-qemu.sh)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#reference" class="nav-link">Reference</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="qemu-cheetsheet">QEMU cheetsheet</h1>
<h2 id="add-qemu-to-path">Add QEMU to PATH</h2>
<pre><code># assuming the qemu source tree has been built, and it is under ./qemu
export PATH=&quot;$(pwd)/qemu/aarch64-softmmu:${PATH}&quot;
</code></pre>
<h2 id="launch-the-kernel">Launch the kernel</h2>
<pre><code>qemu-system-aarch64 -M raspi3 -kernel ./kernel8.img -serial null -serial stdio
</code></pre>
<p>Explanation: 
* -M machine type
* Two "-serial" options correspond to the two UARTs of Rpi3 as emulated by QEMU. Our kernel writes message to the 2nd one. So we tell QEMU to redirect the 2nd UART to stdio. </p>
<h2 id="launch-the-kernel-in-debug-mode">Launch the kernel in debug mode</h2>
<pre><code>qemu-system-aarch64 -M raspi3 -kernel ./kernel8.img -serial null -serial stdio -s -S
</code></pre>
<h2 id="launch-the-kernel-with-monitor">Launch the kernel with monitor</h2>
<pre><code>qemu-system-aarch64 -M raspi3 -kernel ./kernel8.img -monitor stdio
</code></pre>
<h2 id="run-the-kernel-with-tracing">Run the kernel with tracing</h2>
<pre><code>qemu-system-aarch64 -M raspi3 -kernel ./kernel8.img -serial null -serial stdio -d int -D qemu.log 
</code></pre>
<p>Explanation: -d int ---&gt; enable interrupt dedug       -D test.log  ----&gt; put debug msg to a file "qemu.log"</p>
<h2 id="putting-everything-in-one-file-env-qemush">Putting everything in one file (env-qemu.sh)</h2>
<pre><code># change the line as needed
export PATH=&quot;$(pwd)/qemu/aarch64-softmmu:${PATH}&quot;

run-uart0() {
   qemu-system-aarch64 -M raspi3 -kernel ./kernel8.img -serial stdio
}

run() {
    qemu-system-aarch64 -M raspi3 -kernel ./kernel8.img -serial null -serial stdio
}

run-mon() {
    qemu-system-aarch64 -M raspi3 -kernel ./kernel8.img -monitor stdio
}

run-debug() {
    qemu-system-aarch64 -M raspi3 -kernel ./kernel8.img -serial null -serial stdio -s -S
}
</code></pre>
<p>To use: </p>
<pre><code>$ source env-qemu.sh
# change to dir where kernel8.img resides

$ run
VNC server running on 127.0.0.1:5900
kernel boots...
interval is set to: 67108864
</code></pre>
<h2 id="reference">Reference</h2>
<p>https://wiki.osdev.org/QEMU</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
