<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>/dump - p1-kernel</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">p1-kernel</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../lesson00/rpi-os/" class="nav-link">exp0</a>
                            </li>
                            <li class="navitem">
                                <a href="../lesson01/rpi-os/" class="nav-link">exp1</a>
                            </li>
                            <li class="navitem">
                                <a href="../lesson02/rpi-os/" class="nav-link">exp2</a>
                            </li>
                            <li class="navitem">
                                <a href="../lesson03/rpi-os/" class="nav-link">exp3</a>
                            </li>
                            <li class="navitem">
                                <a href="../lesson04a/rpi-os/" class="nav-link">exp4a</a>
                            </li>
                            <li class="navitem">
                                <a href="../lesson04b/rpi-os/" class="nav-link">exp4b</a>
                            </li>
                            <li class="navitem">
                                <a href="../lesson05/rpi-os/" class="nav-link">exp5</a>
                            </li>
                            <li class="navitem">
                                <a href="../lesson06/rpi-os/" class="nav-link">exp6</a>
                            </li>
                            <li class="navitem">
                                <a href="../qemu/" class="nav-link">/qemu</a>
                            </li>
                            <li class="navitem">
                                <a href="../gdb/" class="nav-link">/gdb</a>
                            </li>
                            <li class="navitem">
                                <a href="../cheatsheet/" class="nav-link">/aarch64</a>
                            </li>
                            <li class="navitem">
                                <a href="../ssh-proxy/" class="nav-link">/ssh</a>
                            </li>
                            <li class="navitem active">
                                <a href="./" class="nav-link">/dump</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../ssh-proxy/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" class="nav-link disabled">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#inspect-kernel-binary" class="nav-link">Inspect kernel binary</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#lookup-source-line-given-an-address" class="nav-link">Lookup source line given an address</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#list-all-symbols-addresses" class="nav-link">List all symbols &amp; addresses</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#kernel-disassembly" class="nav-link">Kernel disassembly</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#disassemble-the-whole-kernel" class="nav-link">Disassemble the whole kernel</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#disassemble-a-specific-address-range" class="nav-link">Disassemble a specific address range</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#disassemble-a-specific-function" class="nav-link">Disassemble a specific function</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#dump-a-section-as-raw-bytes" class="nav-link">Dump a section as raw bytes</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="inspect-kernel-binary">Inspect kernel binary</h1>
<h2 id="lookup-source-line-given-an-address">Lookup source line given an address</h2>
<pre><code>addr2line -e build/kernel8.elf 0x80038
</code></pre>
<p>Explanation: -e specifies the ELF file with debugging info, followed by a given address</p>
<h2 id="list-all-symbols-addresses">List all symbols &amp; addresses</h2>
<pre><code>$ nm build/kernel8.elf
</code></pre>
<p>Sample output: <a href="https://github.com/fxlin/p1-kernel/blob/master/src/lesson06/kernel8.nm">kernel8.nm</a></p>
<pre><code class="language-assembly">ffff000000082934 t a2d
ffff0000000829b4 t a2i
...
ffff000000085130 B bss_begin
ffff000000102944 B bss_end
...
ffff000000081000 T user_begin
ffff0000000810c8 T user_delay
ffff00000008112e R user_end
ffff00000008105c T user_process
</code></pre>
<p>Format: "link address" - "symbol type" - "symbol name"</p>
<h2 id="kernel-disassembly">Kernel disassembly</h2>
<h3 id="disassemble-the-whole-kernel">Disassemble the whole kernel</h3>
<pre><code>aarch64-linux-gnu-objdump -dS build/kernel8.elf
</code></pre>
<p>Explanation: -d disassembly; -S interleave assembly instructions with source</p>
<p>Sample output: <a href="https://github.com/fxlin/p1-kernel/blob/master/src/lesson06/kernel8.objdump">kernel8.objdump</a></p>
<pre><code class="language-assembly">build/kernel8.elf:     file format elf64-littleaarch64
Disassembly of section .text.boot:
ffff000000080000 &lt;_start&gt;:
.section &quot;.text.boot&quot;
.globl _start
_start:
        mrs     x0, mpidr_el1
ffff000000080000:       d53800a0        mrs     x0, mpidr_el1
        and     x0, x0,#0xFF            // Check processor id
ffff000000080004:       92401c00        and     x0, x0, #0xff
...
void user_process()
{
ffff00000008105c:       a9be7bfd        stp     x29, x30, [sp, #-32]!
ffff000000081060:       910003fd        mov     x29, sp
        call_sys_write(&quot;User process\n\r&quot;);
ffff000000081064:       90000000        adrp    x0, ffff000000081000 &lt;loop&gt;
ffff000000081068:       9103e000        add     x0, x0, #0xf8
ffff00000008106c:       9400001a        bl      ffff0000000810d4 &lt;call_sys_write&gt;
        int pid = call_sys_fork();
ffff000000081070:       9400001f        bl      ffff0000000810ec &lt;call_sys_fork&gt;
ffff000000081074:       b9001fa0        str     w0, [x29, #28]
...
</code></pre>
<h3 id="disassemble-a-specific-address-range">Disassemble a specific address range</h3>
<pre><code>aarch64-linux-gnu-objdump -dS build/kernel8.elf \
--start-address=0xffff000000081000 \
--stop-address=0xffff00000008112e 
</code></pre>
<p>Sample output: </p>
<pre><code>build/kernel8.elf:     file format elf64-littleaarch64
Disassembly of section .text.user:
ffff000000081000 &lt;loop&gt;:
#include &quot;user_sys.h&quot;
#include &quot;user.h&quot;
#include &quot;printf.h&quot;

void loop(char* str)
{
ffff000000081000:       a9bd7bfd        stp     x29, x30, [sp, #-48]!
ffff000000081004:       910003fd        mov     x29, sp
ffff000000081008:       f9000fa0        str     x0, [x29, #24]
        char buf[2] = {&quot;&quot;};
ffff00000008100c:       790053bf        strh    wzr, [x29, #40]
        while (1){
</code></pre>
<h3 id="disassemble-a-specific-function">Disassemble a specific function</h3>
<pre><code>gdb -batch -ex 'file build/kernel8.elf' -ex 'disassemble /mr loop'
</code></pre>
<p>Sample output:</p>
<pre><code class="language-assembly">Dump of assembler code for function loop:
6       {
   0x00081000 &lt;+0&gt;:     fd      std
   0x00081001 &lt;+1&gt;:     7b bd   jnp    0x80fc0
   0x00081003 &lt;+3&gt;:     a9 fd 03 00 91  test   $0x910003fd,%eax
   0x00081008 &lt;+8&gt;:     a0 0f 00 f9 bf  mov    0xbff9000f,%al

7               char buf[2] = {&quot;&quot;};
</code></pre>
<h2 id="dump-a-section-as-raw-bytes">Dump a section as raw bytes</h2>
<pre><code>aarch64-linux-gnu-objdump -s -j .rodata build/kernel8.elf
</code></pre>
<p>Explanation: -j specify which elf section (.rodata in this example) to dump. </p>
<p>Sample output: </p>
<pre><code>Contents of section .rodata:                                                                                                         [0/1839] ffff0000000849a8 4b65726e 656c2070 726f6365 73732073  Kernel process s
 ffff0000000849b8 74617274 65642e20 454c2025 640d0a00  tarted. EL %d...
 ffff0000000849c8 4572726f 72207768 696c6520 6d6f7669  Error while movi
 ffff0000000849d8 6e672070 726f6365 73732074 6f207573  ng process to us
 ffff0000000849e8 6572206d 6f64650a 0d000000 00000000  er mode.........
 ffff0000000849f8 6b65726e 656c2062 6f6f7473 202e2e2e  kernel boots ...
 ffff000000084a08 0a0d0000 00000000 6572726f 72207768  ........error wh
 ffff000000084a18 696c6520 73746172 74696e67 206b6572  ile starting ker
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
