
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.6">
    
    
      
        <title>/dump - p1-kernel</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.39b8e14a.min.css">
        
          
          
          <meta name="theme-color" content="#4051b5">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#inspect-kernel-binary" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="p1-kernel" class="md-header-nav__button md-logo" aria-label="p1-kernel">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89"><path d="M3.136 17.387v42.932l42.932 21.467L3.136 17.387z"/><path d="M21.91 8l42.933 64.398-18.775 9.388L3.136 17.387 21.91 8z" fill-opacity=".5"/><path d="M67.535 17.387L40.273 35.543l21.878 32.818 5.384 2.691V17.387z"/><path d="M67.535 17.387v53.666l18.774-9.388V8l-18.774 9.387z" fill-opacity=".25"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            p1-kernel
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              /dump
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../lesson00/rpi-os/" class="md-tabs__link">
      exp0
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../lesson01/rpi-os/" class="md-tabs__link">
      exp1
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../lesson02/rpi-os/" class="md-tabs__link">
      exp2
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../lesson03/rpi-os/" class="md-tabs__link">
      exp3
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../lesson04a/rpi-os/" class="md-tabs__link">
      exp4a
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../lesson04b/rpi-os/" class="md-tabs__link">
      exp4b
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../lesson05/rpi-os/" class="md-tabs__link">
      exp5
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../lesson06/rpi-os/" class="md-tabs__link">
      exp6
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../qemu/" class="md-tabs__link">
      /qemu
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../gdb/" class="md-tabs__link">
      /gdb
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../cheatsheet/" class="md-tabs__link">
      /aarch64
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../ssh-proxy/" class="md-tabs__link">
      /ssh
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="./" class="md-tabs__link md-tabs__link--active">
      /dump
    </a>
  </li>

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="p1-kernel" class="md-nav__button md-logo" aria-label="p1-kernel">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89"><path d="M3.136 17.387v42.932l42.932 21.467L3.136 17.387z"/><path d="M21.91 8l42.933 64.398-18.775 9.388L3.136 17.387 21.91 8z" fill-opacity=".5"/><path d="M67.535 17.387L40.273 35.543l21.878 32.818 5.384 2.691V17.387z"/><path d="M67.535 17.387v53.666l18.774-9.388V8l-18.774 9.387z" fill-opacity=".25"/></svg>

    </a>
    p1-kernel
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../lesson00/rpi-os/" class="md-nav__link">
        exp0
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../lesson01/rpi-os/" class="md-nav__link">
        exp1
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../lesson02/rpi-os/" class="md-nav__link">
        exp2
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../lesson03/rpi-os/" class="md-nav__link">
        exp3
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../lesson04a/rpi-os/" class="md-nav__link">
        exp4a
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../lesson04b/rpi-os/" class="md-nav__link">
        exp4b
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../lesson05/rpi-os/" class="md-nav__link">
        exp5
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../lesson06/rpi-os/" class="md-nav__link">
        exp6
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../qemu/" class="md-nav__link">
        /qemu
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../gdb/" class="md-nav__link">
        /gdb
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../cheatsheet/" class="md-nav__link">
        /aarch64
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../ssh-proxy/" class="md-nav__link">
        /ssh
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          /dump
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        /dump
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lookup-source-line-given-an-address" class="md-nav__link">
    Lookup source line given an address
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list-all-symbols-addresses" class="md-nav__link">
    List all symbols &amp; addresses
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kernel-disassembly" class="md-nav__link">
    Kernel disassembly
  </a>
  
    <nav class="md-nav" aria-label="Kernel disassembly">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#disassemble-the-whole-kernel" class="md-nav__link">
    Disassemble the whole kernel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disassemble-a-specific-address-range" class="md-nav__link">
    Disassemble a specific address range
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disassemble-a-specific-function" class="md-nav__link">
    Disassemble a specific function
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dump-a-section-as-raw-bytes" class="md-nav__link">
    Dump a section as raw bytes
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lookup-source-line-given-an-address" class="md-nav__link">
    Lookup source line given an address
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list-all-symbols-addresses" class="md-nav__link">
    List all symbols &amp; addresses
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kernel-disassembly" class="md-nav__link">
    Kernel disassembly
  </a>
  
    <nav class="md-nav" aria-label="Kernel disassembly">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#disassemble-the-whole-kernel" class="md-nav__link">
    Disassemble the whole kernel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disassemble-a-specific-address-range" class="md-nav__link">
    Disassemble a specific address range
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disassemble-a-specific-function" class="md-nav__link">
    Disassemble a specific function
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dump-a-section-as-raw-bytes" class="md-nav__link">
    Dump a section as raw bytes
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="inspect-kernel-binary">Inspect kernel binary</h1>
<h2 id="lookup-source-line-given-an-address">Lookup source line given an address</h2>
<pre><code>addr2line -e build/kernel8.elf 0x80038
</code></pre>
<p>Explanation: -e specifies the ELF file with debugging info, followed by a given address</p>
<h2 id="list-all-symbols-addresses">List all symbols &amp; addresses</h2>
<pre><code>$ nm build/kernel8.elf
</code></pre>
<p>Sample output: <a href="https://github.com/fxlin/p1-kernel/blob/master/src/lesson06/kernel8.nm">kernel8.nm</a></p>
<pre><code class="language-assembly">ffff000000082934 t a2d
ffff0000000829b4 t a2i
...
ffff000000085130 B bss_begin
ffff000000102944 B bss_end
...
ffff000000081000 T user_begin
ffff0000000810c8 T user_delay
ffff00000008112e R user_end
ffff00000008105c T user_process
</code></pre>
<p>Format: "link address" - "symbol type" - "symbol name"</p>
<h2 id="kernel-disassembly">Kernel disassembly</h2>
<h3 id="disassemble-the-whole-kernel">Disassemble the whole kernel</h3>
<pre><code>aarch64-linux-gnu-objdump -dS build/kernel8.elf
</code></pre>
<p>Explanation: -d disassembly; -S interleave assembly instructions with source</p>
<p>Sample output: <a href="https://github.com/fxlin/p1-kernel/blob/master/src/lesson06/kernel8.objdump">kernel8.objdump</a></p>
<pre><code class="language-assembly">build/kernel8.elf:     file format elf64-littleaarch64
Disassembly of section .text.boot:
ffff000000080000 &lt;_start&gt;:
.section &quot;.text.boot&quot;
.globl _start
_start:
        mrs     x0, mpidr_el1
ffff000000080000:       d53800a0        mrs     x0, mpidr_el1
        and     x0, x0,#0xFF            // Check processor id
ffff000000080004:       92401c00        and     x0, x0, #0xff
...
void user_process()
{
ffff00000008105c:       a9be7bfd        stp     x29, x30, [sp, #-32]!
ffff000000081060:       910003fd        mov     x29, sp
        call_sys_write(&quot;User process\n\r&quot;);
ffff000000081064:       90000000        adrp    x0, ffff000000081000 &lt;loop&gt;
ffff000000081068:       9103e000        add     x0, x0, #0xf8
ffff00000008106c:       9400001a        bl      ffff0000000810d4 &lt;call_sys_write&gt;
        int pid = call_sys_fork();
ffff000000081070:       9400001f        bl      ffff0000000810ec &lt;call_sys_fork&gt;
ffff000000081074:       b9001fa0        str     w0, [x29, #28]
...
</code></pre>
<h3 id="disassemble-a-specific-address-range">Disassemble a specific address range</h3>
<pre><code>aarch64-linux-gnu-objdump -dS build/kernel8.elf \
--start-address=0xffff000000081000 \
--stop-address=0xffff00000008112e 
</code></pre>
<p>Sample output: </p>
<pre><code>build/kernel8.elf:     file format elf64-littleaarch64
Disassembly of section .text.user:
ffff000000081000 &lt;loop&gt;:
#include &quot;user_sys.h&quot;
#include &quot;user.h&quot;
#include &quot;printf.h&quot;

void loop(char* str)
{
ffff000000081000:       a9bd7bfd        stp     x29, x30, [sp, #-48]!
ffff000000081004:       910003fd        mov     x29, sp
ffff000000081008:       f9000fa0        str     x0, [x29, #24]
        char buf[2] = {&quot;&quot;};
ffff00000008100c:       790053bf        strh    wzr, [x29, #40]
        while (1){
</code></pre>
<h3 id="disassemble-a-specific-function">Disassemble a specific function</h3>
<pre><code>gdb -batch -ex 'file build/kernel8.elf' -ex 'disassemble /mr loop'
</code></pre>
<p>Sample output:</p>
<pre><code class="language-assembly">Dump of assembler code for function loop:
6       {
   0x00081000 &lt;+0&gt;:     fd      std
   0x00081001 &lt;+1&gt;:     7b bd   jnp    0x80fc0
   0x00081003 &lt;+3&gt;:     a9 fd 03 00 91  test   $0x910003fd,%eax
   0x00081008 &lt;+8&gt;:     a0 0f 00 f9 bf  mov    0xbff9000f,%al

7               char buf[2] = {&quot;&quot;};
</code></pre>
<h2 id="dump-a-section-as-raw-bytes">Dump a section as raw bytes</h2>
<pre><code>aarch64-linux-gnu-objdump -s -j .rodata build/kernel8.elf
</code></pre>
<p>Explanation: -j specify which elf section (.rodata in this example) to dump. </p>
<p>Sample output: </p>
<pre><code>Contents of section .rodata:                                                                                                         [0/1839] ffff0000000849a8 4b65726e 656c2070 726f6365 73732073  Kernel process s
 ffff0000000849b8 74617274 65642e20 454c2025 640d0a00  tarted. EL %d...
 ffff0000000849c8 4572726f 72207768 696c6520 6d6f7669  Error while movi
 ffff0000000849d8 6e672070 726f6365 73732074 6f207573  ng process to us
 ffff0000000849e8 6572206d 6f64650a 0d000000 00000000  er mode.........
 ffff0000000849f8 6b65726e 656c2062 6f6f7473 202e2e2e  kernel boots ...
 ffff000000084a08 0a0d0000 00000000 6572726f 72207768  ........error wh
 ffff000000084a18 696c6520 73746172 74696e67 206b6572  ile starting ker
</code></pre>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../ssh-proxy/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                /ssh
              </div>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.53cc9318.min.js"></script>
      <script src="../assets/javascripts/bundle.e9c9f54f.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: ['navigation.tabs'],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>